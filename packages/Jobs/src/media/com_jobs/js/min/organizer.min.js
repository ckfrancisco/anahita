/*! anahita 15-11-2017 */
!function(a,b){"use strict";a.widget("anahita.setOrganizer",{options:{selector:"#job-selector-list",url:a("#set-jobs").data("url"),jobs:a("#set-jobs").find(".media-grid"),thumbnail:".thumbnail-wrapper",cover:"#set-cover-wrapper",form:"#set-form"},_create:function(){var a=this;this.element.hide(),this.selector=null,this.jobList=null,this._on("body",{'click a[data-trigger="Organize"]':function(b){b.preventDefault(),a.open(b.currentTarget.href)}}),this._on(this.element,{'click a[data-trigger="CloseJobSelector"]':function(b){b.preventDefault(),a.close()}}),this._on(this.options.form,{submit:function(a){this._beforeAdd()}})},open:function(b){var c=this;a.get(b,function(b){c.element.html(b).slideDown(),c.selector=a(c.options.selector).sortable({connectWith:a(c.options.jobs),scroll:!1}),c.jobList=a(c.options.jobs).sortable({connectWith:a(c.options.selector),cancel:".cover",update:function(){c.options.url&&c._edit()}}),c.jobList.parent().addClass("an-highlight")})},close:function(){var a=this;this.element.slideUp("normal",function(){a.selector.sortable("destroy"),a.jobList.sortable("destroy"),a.jobList.parent().removeClass("an-highlight"),a.element.empty()})},_beforeAdd:function(){var b=this,c=b.jobList.find(b.options.thumbnail);0==c.length&&event.preventDefault(),a.each(c,function(c,d){a(b.options.form).append('<input type="hidden" name="job_id[]" value='+a(d).attr("job")+" />")})},_edit:function(){var b=this,c=this.jobList.find(this.options.thumbnail),d="action=updatejobs";a.each(c,function(b,c){d+="&job_id[]="+a(c).attr("job")}),a.ajax({method:"post",url:this.options.url,data:d,success:function(){var c=a(b.options.jobs).find(b.options.thumbnail);c.removeClass("cover"),c.first().addClass("cover"),b._refreshCover()}})},_refreshCover:function(){var b=this;a.ajax({method:"get",url:this.options.url,data:"layout=cover",success:function(c){a(b.options.cover).html(c)}})}}),a("#job-selector").setOrganizer()}(jQuery,window);