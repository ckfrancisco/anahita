/*! anahita 15-11-2017 */
!function(a,b){"use strict";a.widget("anahita.setOrganizer",{options:{selector:"#document-selector-list",url:a("#set-documents").data("url"),documents:a("#set-documents").find(".media-grid"),thumbnail:".thumbnail-wrapper",cover:"#set-cover-wrapper",form:"#set-form"},_create:function(){var a=this;this.element.hide(),this.selector=null,this.documentList=null,this._on("body",{'click a[data-trigger="Organize"]':function(b){b.preventDefault(),a.open(b.currentTarget.href)}}),this._on(this.element,{'click a[data-trigger="CloseDocumentSelector"]':function(b){b.preventDefault(),a.close()}}),this._on(this.options.form,{submit:function(a){this._beforeAdd()}})},open:function(b){var c=this;a.get(b,function(b){c.element.html(b).slideDown(),c.selector=a(c.options.selector).sortable({connectWith:a(c.options.documents),scroll:!1}),c.documentList=a(c.options.documents).sortable({connectWith:a(c.options.selector),cancel:".cover",update:function(){c.options.url&&c._edit()}}),c.documentList.parent().addClass("an-highlight")})},close:function(){var a=this;this.element.slideUp("normal",function(){a.selector.sortable("destroy"),a.documentList.sortable("destroy"),a.documentList.parent().removeClass("an-highlight"),a.element.empty()})},_beforeAdd:function(){var b=this,c=b.documentList.find(b.options.thumbnail);0==c.length&&event.preventDefault(),a.each(c,function(c,d){a(b.options.form).append('<input type="hidden" name="document_id[]" value='+a(d).attr("document")+" />")})},_edit:function(){var b=this,c=this.documentList.find(this.options.thumbnail),d="action=updatedocuments";a.each(c,function(b,c){d+="&document_id[]="+a(c).attr("document")}),a.ajax({method:"post",url:this.options.url,data:d,success:function(){var c=a(b.options.documents).find(b.options.thumbnail);c.removeClass("cover"),c.first().addClass("cover"),b._refreshCover()}})},_refreshCover:function(){var b=this;a.ajax({method:"get",url:this.options.url,data:"layout=cover",success:function(c){a(b.options.cover).html(c)}})}}),a("#document-selector").setOrganizer()}(jQuery,window);